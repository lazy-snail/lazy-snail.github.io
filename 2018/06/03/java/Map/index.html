<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="懒懒懒蜗牛🐌">
  <link 
    rel="icon" 
    href="/img/little-prince.png">
  <title>Map</title>
  
    
      <meta 
        property="og:title" 
        content="Map">
    
    
      <meta 
        property="og:url" 
        content="https://lazy-snail.github.io/2018/06/03/java/Map/index.html">
    
    
      <meta 
        property="og:img" 
        content="/img/little-prince.png">
    
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2018-06-03">
      <meta 
        property="og:article:modified_time" 
        content="2022-06-28">
      <meta 
        property="og:article:author" 
        content="Neil">
      
        
          <meta 
            property="og:article:tag" 
            content="java">
        
          <meta 
            property="og:article:tag" 
            content="容器">
        
      
    
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
      
      
      
      
        
        
        
        <script>
          function prismThemeChange() {
            if(document.getElementById('theme-color').dataset.mode === 'dark') {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism-tomorrow.min.css', '[data-prism]', 'prism-tomorrow');
              } else {
                loadCSS('/js/lib/prism/prism-tomorrow.min.css', 'prism', 'prism-tomorrow');
              }
            } else {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism.min.css', '[data-prism]', 'prism');
              } else {
                loadCSS('/js/lib/prism/prism.min.css', 'prism', 'prism');
              }
            }
          }
          prismThemeChange()
        </script>
      
      
        
        <link rel="stylesheet" href="/js/lib/prism/prism-line-numbers.min.css">
      
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
        prismThemeChange();
      }
    };
    setDarkmode();
    </script>
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
    
    <link rel="prefetch" href="//cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-svg.js" as="script">
  
  
  
  
  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
    <link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">
  
<meta name="generator" content="Hexo 6.1.0"></head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
        <img 
          class="navbar-logo-img"
          width="32"
          height="32"
          src="/img/little-prince.png" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">懒蜗牛</span>
    </span>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/" 
        class="navbar-menu-item">
        
          Home
        
      </a>
    
      <a 
        href="/archives" 
        class="navbar-menu-item">
        
          Archive
        
      </a>
    
      <a 
        href="/tags" 
        class="navbar-menu-item">
        
          Tags
        
      </a>
    
      <a 
        href="/categories" 
        class="navbar-menu-item">
        
          Categories
        
      </a>
    
      <a 
        href="/about" 
        class="navbar-menu-item">
        
          About
        
      </a>
    
    <a 
      class="navbar-menu-item darknavbar" 
      id="dark">
      <i class="iconfont icon-weather"></i>
    </a>
    <a 
      class="navbar-menu-item searchnavbar" 
      id="search">
      <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i>
    </a>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="请输入搜索内容..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      Map
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2018-06-03T11:27:12.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2018-06-03</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/categories/java/" 
          class="post-meta-link">
          java
        </a>
      
    
    
      <span class="dot"></span>
      <span>2.9k words</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/tags/java/" 
            class="post-meta-link">
            java
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/%E5%AE%B9%E5%99%A8/" 
            class="post-meta-link">
            容器
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <p>[toc]</p>
<h1 id="Map-接口"><a href="#Map-接口" class="headerlink" title="Map 接口"></a>Map 接口</h1><p>Map 可以看作是一种符号表，使用键值对的数据结构存储数据。<br>实现了 Map 接口的常用容器类：包括非线程安全的 HashMap、LinkedHashMap、TreeMap，线程安全的 ConcurrentHashMap、ConcurrentSkipListMap，线程安全但目前已不推荐使用的 HashTable。</p>
<h1 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h1><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>其内部的 Node 结构：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
        <span class="token class-name">V</span> value<span class="token punctuation">;</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>初始大小 DEFAULT_INITIAL_CAPACITY &#x3D; 1 &lt;&lt; 4; &#x2F;&#x2F; aka 16。即初始大小为 16。</p>
<h2 id="树化-x2F-退化"><a href="#树化-x2F-退化" class="headerlink" title="树化&#x2F;退化"></a>树化&#x2F;退化</h2><p>为了提高哈希碰撞下的寻址性能，在链表长度超过树化阈值时将链表转换为一棵红黑树，即将寻址时间复杂度从 O(n) 降低到 O(logn)：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TREEIFY_THRESHOLD <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> UNTREEIFY_THRESHOLD <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> TREEIFY_THRESHOLD<span class="token punctuation">)</span>
    <span class="token comment">// Conversion from/to TreeBins</span>
    <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>同样地，当链表长度减小到退化阈值，原本红黑树化的链表会重新组织成一个链表，此时尽管是 O(n) 的查询时间，但由于链表较短，性能依然很好。<br>基于 HashMap 实现的其他版本也有此演进（详见JDK1.7- 到 JDK1.8+ 源码变化）。</p>
<h2 id="寻址方式-x2F-hash-值计算"><a href="#寻址方式-x2F-hash-值计算" class="headerlink" title="寻址方式&#x2F;hash 值计算"></a>寻址方式&#x2F;hash 值计算</h2><p>通过 Key 的哈希值与数组长度取模确定该 Key 在数组中的索引。<br>JDK1.8+ HashMap 作者认为引入红黑树转化策略后，即使哈希冲突比较严重，寻址效率也足够高，所以并未在哈希值计算上做过多设计。具体做法只将 Key 的 hashCode 高 16 位保持不变，低 16 位与高 16 位进行异或操作，得到的值作为低 16 位的值，即得到 hash 值（即 hash()）：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> h<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>关于该扰动函数的分析可以看这里：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20733617/answer/111577937">Java 8 HashMap 中 hash() 方法分析</a></p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>非线程安全的；</li>
<li>根据键的 hashCode 值存储数据。大多数情况下可以直接定位键值对，因而具有很快的访问速度，理论上时间复杂度为 O(1)；</li>
<li>遍历顺序是不确定的，也无法支持随机访问；</li>
<li>不允许重复键，最多只允许一条记录的键为 null，允许多条记录的值为 null。</li>
</ul>
<h2 id="hashCode-方法和加载因子"><a href="#hashCode-方法和加载因子" class="headerlink" title="hashCode 方法和加载因子"></a>hashCode 方法和加载因子</h2><p>HashMap 基于哈希函数来存储键值对，即，由一个哈希函数决定每个键值对的存放位置，存放位置所使用的数据结构为一个数组，其初始容量为 16，并且要求该值必须为 2 的幂，这与其底层数据结构有关。在不出现哈希碰撞（两个键值对的哈希结果相同）的情况下，即完美哈希时，访问时间复杂度即为 O(1)。HashMap 使用 <strong>开散列</strong> 方法来解决哈希冲突，即，<strong>对应一个特定 hash 值的位置存储的是一个链表头，指向 hash 到同一个位置的多个键值对组成的链表</strong>。这种实现的访问时间复杂度显然不是常数级，且随着键值对的增多，发生碰撞的情况会加剧。所以 HashMap 有一个加载因子（DEFAULT_LOAD_FACTOR &#x3D; 0.75f），<strong>用来控制当 HashMap 到达一定“装载程度”时执行 rehash（重哈希）操作，使得容量变为原来的约 2 倍</strong>。注意，重哈希是个非常耗时的操作，所以有必要采取一些措施（比如预估并在初始化时调用指定初始数组容量的构造方法）来避免&#x2F;减少。</p>
<h2 id="重写-hashCode-和-equal"><a href="#重写-hashCode-和-equal" class="headerlink" title="重写 hashCode() 和 equal()"></a>重写 hashCode() 和 equal()</h2><p>HashMap 的很多方法都是基于 hashCode() 和 equal() 的，前者用来定位，后者用来判断是否相等。很多情况下，equal 方法可能并不符合我们程序的逻辑——Object 的 equel 方法只是简单地判断是不是同一个实例，因此当我们认为判定 equals 应该是逻辑上的相等而不是仅仅判断是不是内存中中同一个东西的时候，就需要重写 equal()，此时，就必须重写 hashCode()。<br>重写 equal() 要使得其依然满足：</p>
<ul>
<li>自反性</li>
<li>对称性</li>
<li>传递性</li>
<li>一致性</li>
</ul>
<h2 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h2><p>put()、get()：根据数据结构特点可知，先利用 hashCode 定位到具体的链表，再在链表中遍历是否已存在，然后操作。</p>
<h2 id="resize-死循环"><a href="#resize-死循环" class="headerlink" title="resize 死循环"></a>resize 死循环</h2><p>当 HashMap 的 size 超过 Capacity * loadFactor 时，即需要重哈希扩容时，将原来的数据重新计算哈希值并插入到新的数组中的过程，是非线程安全的，在多线程并发执行该操作的过程中，可能出现死循环，即在重新链接时出现环，导致失败。</p>
<h2 id="fast-fail"><a href="#fast-fail" class="headerlink" title="fast-fail"></a>fast-fail</h2><p>在使用迭代器的过程中，如果 HashMap 被修改，那么将抛出 ConcurrentModificationException，即 Fast-fail 策略：在并发集合进行迭代操作时，若有其他线程对其进行结构性的修改，这时迭代器会立马感知到，并立即抛出 ConcurrentModificationException 异常，而不是等到迭代完成之后才告诉你（此时早已经出错了）。</p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="容量为什么必须是-2-的幂？"><a href="#容量为什么必须是-2-的幂？" class="headerlink" title="容量为什么必须是 2 的幂？"></a>容量为什么必须是 2 的幂？</h3><p>HashMap 中的数据结构是数组 + 单链表的组合。我们希望元素存放的更均匀，理想情况是，Entry 数组中每个位置都只有一个元素，这样，查询的时候效率最高，不需要遍历单链表，也不需要通过 equals() 去比较 K，而且空间利用率最大，时间复杂度最优。<br>而使得计算分布得更均匀，就是使用 % 运算，即取模：<br>哈希值 % 容量 &#x3D; bucketIndex<br>当容量为 2 的幂时，可以（也是源码方法）写成：<br>h &amp; (length - 1) ，<br>这与前式等价但不等效：后者位运算的效率更高（CPU 效率最慢的也就是除法和取余了）！</p>
<h3 id="加载因子怎么选择，为什么默认-0-75？"><a href="#加载因子怎么选择，为什么默认-0-75？" class="headerlink" title="加载因子怎么选择，为什么默认 0.75？"></a>加载因子怎么选择，为什么默认 0.75？</h3><p>这是一种时间和空间的折中选择：加载因子过高虽然减少了空间开销，但同时也增加了查询成本；反之亦然。</p>
<h3 id="可以存储-null-吗？"><a href="#可以存储-null-吗？" class="headerlink" title="可以存储 null 吗？"></a>可以存储 null 吗？</h3><p>可以。<br>jdk1.8 对 key&#x3D;null 的处理是：首先该 key 的 hash() 返回值为 0，此时 put() 方法按照（hash() &amp; (length-1)）确定该元素所在的桶位置，可见为 0。即，key&#x3D;null 时，元素存放在数组的起始位置（即第一个桶中）。</p>
<p><a target="_blank" rel="noopener" href="http://capps.cn/EbQRVj" title="理解 HashMap">参考博客</a></p>
<h1 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a>LinkedHashMap</h1><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>其内部的 Entry 扩展了 HashMap 的 Node 并添加了两个指针：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">extends</span> <span class="token class-name">HashMap<span class="token punctuation">.</span>Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> before<span class="token punctuation">,</span> after<span class="token punctuation">;</span>
    <span class="token class-name">Entry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="/2018/06/03/java/Map/06/03/java/Map/LinkedHashMap%E7%A4%BA%E6%84%8F%E5%9B%BE.png" class title="LinkedHashMap示意图" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/2018/06/03/java/Map/06/03/java/Map/LinkedHashMap%E7%A4%BA%E6%84%8F%E5%9B%BE.png" class="lozad post-image">
<p>将所有节点链入一个双向链表的 HashMap。继承自 HashMap，所以拥有 HashMap 的所有特性。比如，LinkedHashMap 的元素存取过程基本与 HashMap 基本类似，只是在细节实现上稍有不同。这是由 LinkedHashMap 本身的特性所决定的，因为它额外维护了一个双向链表用于 <strong>保持迭代顺序</strong>，并重写了HashMap 的迭代器，使用其维护的双向链表进行迭代输出，可以以插入顺序遍历元素——这是和无序的 HashMap 最大的区别。</p>
<h3 id="存取"><a href="#存取" class="headerlink" title="存取"></a>存取</h3><p>LinkedHashMap 的存取过程与 HashMap 基本类似，只是在细节实现上稍有不同，这是由 LinkedHashMap 本身的特性所决定的，因为它要额外维护一个双向链表用于保持迭代顺序。put 操作上，虽然 LinkedHashMap 完全继承了 HashMap 的 put 操作，但是在细节上还是做了一定的调整，比如，在 LinkedHashMap 中向哈希表中插入新 Entry 的同时，还会通过 Entry 的 addBefore 方法将其链入到双向链表中。在扩容操作上，虽然 LinkedHashMap 完全继承了 HashMap的resize 操作，但是鉴于性能和 LinkedHashMap 自身特点的考量，LinkedHashMap 对其中的重哈希过程(transfer方法)进行了重写。get 操作上，LinkedHashMap 重写了 HashMap 的 get 方法，通过 HashMap 的 getEntry 方法获取 Entry 对象，在此基础上，进一步获取指定键对应的值。</p>
<h3 id="LinkedHashMap-与-LRU"><a href="#LinkedHashMap-与-LRU" class="headerlink" title="LinkedHashMap 与 LRU"></a>LinkedHashMap 与 LRU</h3><p>当使用 LinkedHashMap 实现 LRU 算法时，需要调用其第 5 个构造方法，将 accessOrder 置为 true，即，元素按访问顺序排序（默认 false 按插入顺序排序）。LinkedHashMap 重写了 HashMap 的 recordAccess 方法（HashMap中该方法为空），当调用父类的put 方法时，在发现 key 已经存在时，会调用该方法；当调用自己的 get 方法时，也会调用到该方法。该方法提供了 LRU 算法的实现，它将最近使用的 Entry 放到双向循环链表的尾部。即当 accessOrder 为 true 时，get 方法和 put 方法都会调用 recordAccess 方法使得最近使用的 Entry 移到双向链表的末尾；当 accessOrder 为默认值 false 时，从源码中可以看出 recordAccess 方法什么也不会做。<br>可以用以上方法快速构建 LRU 算法实现。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/justloveyou_/article/details/71713781" title="理解 LinkedHashMap">参考博客</a></p>
<h2 id="TreeMap-红黑树结构的-Map"><a href="#TreeMap-红黑树结构的-Map" class="headerlink" title="TreeMap 红黑树结构的 Map"></a>TreeMap 红黑树结构的 Map</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">NavigableMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>继承了 AbstractMap，而 AbstractMap 实现了 Map 接口，并实现了 Map 接口中定义的方法，减少了其子类继承的复杂度；</li>
<li>实现了 Map 接口，成为 Map 框架中的一员，可以包含 key-value 形式的元素；</li>
<li>实现了 NavigableMap 接口，拥有了更强的元素搜索能力；</li>
<li>实现了 Cloneable 接口，实现了 clone() 方法，可以被克隆；</li>
<li>实现了 Serializable 接口，支持序列化操作，可通过 Hessian 协议进行传输；</li>
</ul>
<h3 id="NavigableMap-amp-SortedMap-接口"><a href="#NavigableMap-amp-SortedMap-接口" class="headerlink" title="NavigableMap &amp; SortedMap 接口"></a>NavigableMap &amp; SortedMap 接口</h3><img src="/2018/06/03/java/Map/06/03/java/Map/NavigableMap%E6%8E%A5%E5%8F%A3.png" class title="NavigableMap接口" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="/2018/06/03/java/Map/06/03/java/Map/NavigableMap%E6%8E%A5%E5%8F%A3.png" class="lozad post-image">
<p>其中，SortedMap 接口定义了 Comparator&lt;? super K&gt;，即比较器，这决定了 TreeMap 体系的走向，也是其有别于 HashMap 体系最关键的一个接口实现：用比较器对插入元素进行排序，从而决定其插入位置。<br>NavigableMap 接口进一步扩展了 SortedMap 接口：主要用于 <strong>增强对元素的搜索获取操作，如返回集合中某一区间的元素、返回小于&#x2F;大于某一值的元素等</strong>。</p>
<h4 id="排序方式"><a href="#排序方式" class="headerlink" title="排序方式"></a>排序方式</h4><ul>
<li>默认情况下，使用元素自然排序，需要元素实现 Comparable 接口；</li>
<li>使用自定义比较器排序，需要在创建 TreeMap 对象时，将自定义比较器对象传入到其构造方法中。此时无需再实现 Comparable 接口。</li>
</ul>
<h3 id="RB-tree"><a href="#RB-tree" class="headerlink" title="RB-tree"></a>RB-tree</h3><p>TreeMap 底层使用红黑树实现，具有理论 O(logn) 的操作时间复杂度，增删操作通过旋转操作保持树的平衡性。<br><a target="_blank" rel="noopener" href="https://algs4.cs.princeton.edu/33balanced/" title="Algs4 中关于红黑树的部分">Algs4 中关于红黑树的部分</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2dcff3634326" title="参考博客">参考博客</a></p>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li>非线程安全</li>
<li>不允许出现重复键；可以插入 null 键（最多一个），null 值（不限制）；</li>
<li>可以对元素进行排序；</li>
<li>无序集合：插入和遍历顺序不一致。</li>
</ul>
<h3 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a>主要方法</h3><ul>
<li>gut：利用平衡树的快速查找，可以在 O(logn) 时间内定位要查找的元素；</li>
<li>put：如果存在，old value 被替换；如果不存在，则新增节点，然后对红黑树通过旋转作平衡操作；</li>
<li>遍历：类似于中序遍历的方式迭代输出所有元素；</li>
</ul>
<h3 id><a href="#" class="headerlink" title="###"></a>###</h3><p>以上 3 个是 Map 的基础实现，尤其是 HashMap，是 java 中最为常用的数据结构。它们都是非线程安全的，但可以通过 Collections 类的 synchronized 相关方法将它们转换为同步类。此外，java 实现了与之对应的线程安全的容器类。</p>
<h3 id="-1"><a href="#-1" class="headerlink" title="###"></a>###</h3>
  </div>
  <div>
    
      <div 
        class="post-note note-warning copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">作者：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/about">
            Neil
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">文章链接：</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="https://lazy-snail.github.io/2018/06/03/java/Map/">
            https://lazy-snail.github.io/2018/06/03/java/Map/
          </a>
        </p>
        <p><span style="font-weight: bold;">版权声明：</span>转载请注明出处</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/2018/06/03/java/Map-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8/" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">Prev</div>
          
            <div class="nav-title">Map-线程安全 </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/2018/06/03/java/Exception/" 
        class="nav-link">
        <div>
          <div class="nav-label">Next</div>
          
            <div class="nav-title">Exception </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>TOC
</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Map-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.</span> <span class="toc-text">Map 接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HashMap"><span class="toc-number">2.</span> <span class="toc-text">HashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E5%8C%96-x2F-%E9%80%80%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">树化&#x2F;退化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F-x2F-hash-%E5%80%BC%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.</span> <span class="toc-text">寻址方式&#x2F;hash 值计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hashCode-%E6%96%B9%E6%B3%95%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%9B%A0%E5%AD%90"><span class="toc-number">2.4.</span> <span class="toc-text">hashCode 方法和加载因子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%86%99-hashCode-%E5%92%8C-equal"><span class="toc-number">2.5.</span> <span class="toc-text">重写 hashCode() 和 equal()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">2.6.</span> <span class="toc-text">常用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resize-%E6%AD%BB%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.7.</span> <span class="toc-text">resize 死循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fast-fail"><span class="toc-number">2.8.</span> <span class="toc-text">fast-fail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.9.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E9%87%8F%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%85%E9%A1%BB%E6%98%AF-2-%E7%9A%84%E5%B9%82%EF%BC%9F"><span class="toc-number">2.9.1.</span> <span class="toc-text">容量为什么必须是 2 的幂？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%9B%A0%E5%AD%90%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4-0-75%EF%BC%9F"><span class="toc-number">2.9.2.</span> <span class="toc-text">加载因子怎么选择，为什么默认 0.75？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A8-null-%E5%90%97%EF%BC%9F"><span class="toc-number">2.9.3.</span> <span class="toc-text">可以存储 null 吗？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LinkedHashMap"><span class="toc-number">3.</span> <span class="toc-text">LinkedHashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%8F%96"><span class="toc-number">3.0.2.</span> <span class="toc-text">存取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedHashMap-%E4%B8%8E-LRU"><span class="toc-number">3.0.3.</span> <span class="toc-text">LinkedHashMap 与 LRU</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TreeMap-%E7%BA%A2%E9%BB%91%E6%A0%91%E7%BB%93%E6%9E%84%E7%9A%84-Map"><span class="toc-number">3.1.</span> <span class="toc-text">TreeMap 红黑树结构的 Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NavigableMap-amp-SortedMap-%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.1.1.</span> <span class="toc-text">NavigableMap &amp; SortedMap 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">排序方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RB-tree"><span class="toc-number">3.1.2.</span> <span class="toc-text">RB-tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">3.1.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.4.</span> <span class="toc-text">主要方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.1.5.</span> <span class="toc-text">###</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">3.1.6.</span> <span class="toc-text">###</span></a></li></ol></li></ol></li></ol>
</div></main>
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="/img/little-prince.png" 
    class="author-img"
    width="88"
    height="88"
    alt="author avatar">

<p class="author-name">Neil</p>
<p class="author-description">there's a will there's a way</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/archives">
    <span>171</span>
    <span>Posts</span>
  </a>
  <a 
    class="author-categories-count" 
    href="/categories">
    <span>13</span>
    <span>Categories</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/tags">
    <span>31</span>
    <span>Tags</span>
  </a>
</div>

              </div>
               <div class="sticky-tablet">
  
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>TOC
</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Map-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.</span> <span class="toc-text">Map 接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HashMap"><span class="toc-number">2.</span> <span class="toc-text">HashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E5%8C%96-x2F-%E9%80%80%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">树化&#x2F;退化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F-x2F-hash-%E5%80%BC%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.</span> <span class="toc-text">寻址方式&#x2F;hash 值计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hashCode-%E6%96%B9%E6%B3%95%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%9B%A0%E5%AD%90"><span class="toc-number">2.4.</span> <span class="toc-text">hashCode 方法和加载因子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%86%99-hashCode-%E5%92%8C-equal"><span class="toc-number">2.5.</span> <span class="toc-text">重写 hashCode() 和 equal()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">2.6.</span> <span class="toc-text">常用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resize-%E6%AD%BB%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.7.</span> <span class="toc-text">resize 死循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fast-fail"><span class="toc-number">2.8.</span> <span class="toc-text">fast-fail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.9.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E9%87%8F%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%85%E9%A1%BB%E6%98%AF-2-%E7%9A%84%E5%B9%82%EF%BC%9F"><span class="toc-number">2.9.1.</span> <span class="toc-text">容量为什么必须是 2 的幂？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%9B%A0%E5%AD%90%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4-0-75%EF%BC%9F"><span class="toc-number">2.9.2.</span> <span class="toc-text">加载因子怎么选择，为什么默认 0.75？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A8-null-%E5%90%97%EF%BC%9F"><span class="toc-number">2.9.3.</span> <span class="toc-text">可以存储 null 吗？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LinkedHashMap"><span class="toc-number">3.</span> <span class="toc-text">LinkedHashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%8F%96"><span class="toc-number">3.0.2.</span> <span class="toc-text">存取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedHashMap-%E4%B8%8E-LRU"><span class="toc-number">3.0.3.</span> <span class="toc-text">LinkedHashMap 与 LRU</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TreeMap-%E7%BA%A2%E9%BB%91%E6%A0%91%E7%BB%93%E6%9E%84%E7%9A%84-Map"><span class="toc-number">3.1.</span> <span class="toc-text">TreeMap 红黑树结构的 Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NavigableMap-amp-SortedMap-%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.1.1.</span> <span class="toc-text">NavigableMap &amp; SortedMap 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">排序方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RB-tree"><span class="toc-number">3.1.2.</span> <span class="toc-text">RB-tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">3.1.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.4.</span> <span class="toc-text">主要方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.1.5.</span> <span class="toc-text">###</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">3.1.6.</span> <span class="toc-text">###</span></a></li></ol></li></ol></li></ol>
      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>Categories
  </div>
  <div class="categories-list">
    
      <a href="/categories/Algs/">
        <div class="categories-list-item">
          Algs
          <span class="categories-list-item-badge">10</span>
        </div>
      </a>
    
      <a href="/categories/algs/">
        <div class="categories-list-item">
          algs
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/CS/">
        <div class="categories-list-item">
          CS
          <span class="categories-list-item-badge">9</span>
        </div>
      </a>
    
      <a href="/categories/CN/">
        <div class="categories-list-item">
          CN
          <span class="categories-list-item-badge">10</span>
        </div>
      </a>
    
      <a href="/categories/java/">
        <div class="categories-list-item">
          java
          <span class="categories-list-item-badge">62</span>
        </div>
      </a>
    
      <a href="/categories/backend/">
        <div class="categories-list-item">
          backend
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/middleware/">
        <div class="categories-list-item">
          middleware
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/tools/">
        <div class="categories-list-item">
          tools
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
      <a href="/categories/DB/">
        <div class="categories-list-item">
          DB
          <span class="categories-list-item-badge">14</span>
        </div>
      </a>
    
      <a href="/categories/OS/">
        <div class="categories-list-item">
          OS
          <span class="categories-list-item-badge">14</span>
        </div>
      </a>
    
      <a href="/categories/cpp/">
        <div class="categories-list-item">
          cpp
          <span class="categories-list-item-badge">20</span>
        </div>
      </a>
    
      <a href="/categories/Daily/">
        <div class="categories-list-item">
          Daily
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/py/">
        <div class="categories-list-item">
          py
          <span class="categories-list-item-badge">1</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>hot tags
  </div>
  <div class="tags-list">
    
      <a 
        href="/tags/java/" 
        title="java">
        <div class="tags-list-item">java</div>
      </a>
    
      <a 
        href="/tags/cpp/" 
        title="cpp">
        <div class="tags-list-item">cpp</div>
      </a>
    
      <a 
        href="/tags/OS/" 
        title="OS">
        <div class="tags-list-item">OS</div>
      </a>
    
      <a 
        href="/tags/DB/" 
        title="DB">
        <div class="tags-list-item">DB</div>
      </a>
    
      <a 
        href="/tags/%E5%AE%B9%E5%99%A8/" 
        title="容器">
        <div class="tags-list-item">容器</div>
      </a>
    
      <a 
        href="/tags/MySQL/" 
        title="MySQL">
        <div class="tags-list-item">MySQL</div>
      </a>
    
      <a 
        href="/tags/%E5%B9%B6%E5%8F%91/" 
        title="并发">
        <div class="tags-list-item">并发</div>
      </a>
    
      <a 
        href="/tags/JVM/" 
        title="JVM">
        <div class="tags-list-item">JVM</div>
      </a>
    
      <a 
        href="/tags/CN/" 
        title="CN">
        <div class="tags-list-item">CN</div>
      </a>
    
      <a 
        href="/tags/Algs/" 
        title="Algs">
        <div class="tags-list-item">Algs</div>
      </a>
    
      <a 
        href="/tags/CS/" 
        title="CS">
        <div class="tags-list-item">CS</div>
      </a>
    
      <a 
        href="/tags/Q-A/" 
        title="Q&A">
        <div class="tags-list-item">Q&amp;A</div>
      </a>
    
      <a 
        href="/tags/%E6%96%B0%E7%89%B9%E6%80%A7/" 
        title="新特性">
        <div class="tags-list-item">新特性</div>
      </a>
    
      <a 
        href="/tags/%E7%BA%BF%E7%A8%8B/" 
        title="线程">
        <div class="tags-list-item">线程</div>
      </a>
    
      <a 
        href="/tags/Sort/" 
        title="Sort">
        <div class="tags-list-item">Sort</div>
      </a>
    
      <a 
        href="/tags/Linux/" 
        title="Linux">
        <div class="tags-list-item">Linux</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>TOC
</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Map-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.</span> <span class="toc-text">Map 接口</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HashMap"><span class="toc-number">2.</span> <span class="toc-text">HashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%91%E5%8C%96-x2F-%E9%80%80%E5%8C%96"><span class="toc-number">2.1.</span> <span class="toc-text">树化&#x2F;退化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F-x2F-hash-%E5%80%BC%E8%AE%A1%E7%AE%97"><span class="toc-number">2.2.</span> <span class="toc-text">寻址方式&#x2F;hash 值计算</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hashCode-%E6%96%B9%E6%B3%95%E5%92%8C%E5%8A%A0%E8%BD%BD%E5%9B%A0%E5%AD%90"><span class="toc-number">2.4.</span> <span class="toc-text">hashCode 方法和加载因子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%86%99-hashCode-%E5%92%8C-equal"><span class="toc-number">2.5.</span> <span class="toc-text">重写 hashCode() 和 equal()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-number">2.6.</span> <span class="toc-text">常用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resize-%E6%AD%BB%E5%BE%AA%E7%8E%AF"><span class="toc-number">2.7.</span> <span class="toc-text">resize 死循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fast-fail"><span class="toc-number">2.8.</span> <span class="toc-text">fast-fail</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">2.9.</span> <span class="toc-text">问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E9%87%8F%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BF%85%E9%A1%BB%E6%98%AF-2-%E7%9A%84%E5%B9%82%EF%BC%9F"><span class="toc-number">2.9.1.</span> <span class="toc-text">容量为什么必须是 2 的幂？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%9B%A0%E5%AD%90%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E9%BB%98%E8%AE%A4-0-75%EF%BC%9F"><span class="toc-number">2.9.2.</span> <span class="toc-text">加载因子怎么选择，为什么默认 0.75？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E4%BB%A5%E5%AD%98%E5%82%A8-null-%E5%90%97%EF%BC%9F"><span class="toc-number">2.9.3.</span> <span class="toc-text">可以存储 null 吗？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LinkedHashMap"><span class="toc-number">3.</span> <span class="toc-text">LinkedHashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.0.1.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%8F%96"><span class="toc-number">3.0.2.</span> <span class="toc-text">存取</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LinkedHashMap-%E4%B8%8E-LRU"><span class="toc-number">3.0.3.</span> <span class="toc-text">LinkedHashMap 与 LRU</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TreeMap-%E7%BA%A2%E9%BB%91%E6%A0%91%E7%BB%93%E6%9E%84%E7%9A%84-Map"><span class="toc-number">3.1.</span> <span class="toc-text">TreeMap 红黑树结构的 Map</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NavigableMap-amp-SortedMap-%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.1.1.</span> <span class="toc-text">NavigableMap &amp; SortedMap 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%96%B9%E5%BC%8F"><span class="toc-number">3.1.1.1.</span> <span class="toc-text">排序方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RB-tree"><span class="toc-number">3.1.2.</span> <span class="toc-text">RB-tree</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9-1"><span class="toc-number">3.1.3.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.4.</span> <span class="toc-text">主要方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">3.1.5.</span> <span class="toc-text">###</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#-1"><span class="toc-number">3.1.6.</span> <span class="toc-text">###</span></a></li></ol></li></ol></li></ol>
    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>Recent Posts
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-06-28</div>
        <a href="/2022/06/28/java/AOP/"><div class="recent-posts-item-content"></div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-06-28</div>
        <a href="/2022/06/28/java/SpringBoot%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/"><div class="recent-posts-item-content"></div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-06-28</div>
        <a href="/2022/06/28/java/%E6%B3%A8%E8%A7%A3-Transactional/"><div class="recent-posts-item-content"></div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-06-28</div>
        <a href="/2022/06/28/java/SpringMVC%20%E6%8B%A6%E6%88%AA%E5%99%A8/"><div class="recent-posts-item-content"></div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright ©
          
            2017 -
          
          2022
        </span>
        &nbsp;
        <a 
          href="/" 
          class="footer-link">
          懒蜗牛
        </a>
      </div>
    </div>

    
      <div class="footer-dsc">
        
          Powered by
          <a 
            href="https://hexo.io/" 
            class="footer-link" 
            target="_blank" 
            rel="nofollow noopener noreferrer">
            &nbsp;Hexo
          </a>
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          Theme -
          <a 
            href="https://github.com/theme-kaze" 
            class="footer-link" 
            target="_blank"
            rel="nofollow noopener noreferrer">
            &nbsp;Kaze
          </a>
        
      </div>
    
    
    
    
      <div class="footer-dsc">
        
        
        
      </div>
      
    
</footer> 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="回到顶部">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton"
  aria-label="menu button"
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="控制中心">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="夜色模式">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="搜索">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
      

  
  
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
      };
    </script>
    
<script src="//cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-svg.js"></script>

  
 
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/js/main.js"></script> 
    
      <script> 
        loadScript('/js/lib/busuanzi.min.js') 
      </script>
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/js/lib/lozad.min.js', addLazyload)
      </script>
     
    
    
      <script>
        setTimeout(() => {localSearch("search.json")}, 0)
      </script>
    
  </body>
</html>
